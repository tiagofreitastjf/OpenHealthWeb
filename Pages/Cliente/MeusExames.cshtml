@page
@using Microsoft.AspNetCore.Http
@inject Microsoft.AspNetCore.Http.IHttpContextAccessor HttpContextAccessor
@model OpenHealthWeb.Pages.Cliente.MeusExamesModel

@{
}

<div class="col-md-12 d-flex justify-content-center">
    <div class="card col-9">
        <div class="card-body">
            <div class="col-md-12 text-center">
                <h3>Exames</h3>
            </div>
            <div class="spinner-border" role="status" id="spCarregando" style="display: none">
                <span class="sr-only"></span>
            </div>
            <div class="form-group row col-md-12" id="divMeusExames">
                
            </div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function () {
        carregaPagina();
    });

    function carregaPagina() {
        $('#divMeusExames').hide();
        $('#spCarregando').show();
        ajaxRequestApi('@HttpContextAccessor.HttpContext.Session.GetString("tipoUsuario")' == 'Paciente' ? 'http://localhost:5000/Exame/Cliente' : 'http://localhost:5000/Exame/Clinica', 'GET', {
             'idCliente': '@HttpContextAccessor.HttpContext.Session.GetString("idUsuario")',
             'idClinica' : '@HttpContextAccessor.HttpContext.Session.GetString("idClinica")'
        }, '', function (e, statusCode) {
            if (statusCode == 200) {
                if (e.mensagem) {
                    alert(e.mensagem);
                    return;
                }
                 e.forEach(function (e) {
                     $('#divMeusExames').append(`<div class="card" style="width: 18rem;">
                    <div class="card-body">
                        <h5 class="card-title">${e.data.split('T')[0].split('-').reverse().join('/')}</h5>
                        <p class="card-text">${(e.observacao ? e.observacao : '')}</p>
                        <a href="${e.arquivoBase64}" class="btn btn-success btn-sm" download="${e.nomeArquivo}">Download</a>
                    </div>
                </div>`);
                 });

             }
             $('#spCarregando').hide();
             $('#divMeusExames').show();
         });

    }
</script>